fill = "Etapa" # Leyenda del relleno
) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5)) +
scale_fill_viridis_d(option= "D")
print(boxplot_supervivenciafinal)
#Comprobamos normalidad
shapiro.test(datos_grafico)
#Comprobamos normalidad
shapiro.test(datos_grafico$overall_survival_months)
kruskal.test(datos_grafico)
kruskal.test(datos_grafico$overall_survival_months)
kruskal.test(overall_survival_months ~ tumor_stage, data= datos_grafico)
library(FSA)
#instalar paquetes necesarios
#install.packages("dplyr")
#install.packages("naniar")
install.packages(FSA)
#instalar paquetes necesarios
#install.packages("dplyr")
#install.packages("naniar")
install.packages("FSA")
library(FSA)
library(FSA)
#hacemos post-hoc para ver entre qué etapas hay diferencia
dunnTest(overall_survival_moths ~ tumor_stage,
data= datos_grafico, method= "bonferroni")
#hacemos post-hoc para ver entre qué etapas hay diferencia
dunnTest(overall_survival_months ~ tumor_stage,
data= datos_grafico, method= "bonferroni")
tabla_dunn <- resultado_dunn$res
#hacemos post-hoc para ver entre qué etapas hay diferencia
resultado_dunn <- dunnTest(overall_survival_months ~ tumor_stage,
data= datos_grafico, method= "bonferroni")
tabla_dunn <- resultado_dunn$res
significativos <- subset(tabla_dunn, p.adj < 0.05)
#hacemos post-hoc para ver entre qué etapas hay diferencia
resultado_dunn <- dunnTest(overall_survival_months ~ tumor_stage,
data= datos_grafico, method= "bonferroni")
tabla_dunn <- resultado_dunn$res #extraemos tabla de resultados
significativos <- subset(tabla_dunn, P.adj < 0.05)
significativos
significativos <- tabla_dunn %>%
filter(P.adj < 0.05)
significativos
significativos %>%
select(Comparison, P.adj, Z)
str(datos_clinicos)
#vamos a ver los datos perdidos
# Detectar valores vacíos
sapply(datos_clinicos, function(x) sum(x == "", na.rm= TRUE))
# converir valores vacíos a NA
datos_clinicos[datos_clinicos == ""] <- NA
#NA por columna
na_clinicos <- colSums(is.na(datos_clinicos)) #te devuelve la tabla entera
na_clinicos[na_clinicos>1] #para ver qué variables tienen más NA
#vamos a ver los datos perdidos
# Detectar valores vacíos
sapply(datos_clinicos, function(x) sum(x == "", na.rm= TRUE))
# Revisar porcentaje de NA por columna
colMeans(is.na(datos_clinicos)) * 100
which(colMeans(is.na(datos_clinicos))
> 0.02) #tumor_stage es la columna con mayor número de datos perdidos, con el 30% de datos perdidos, en total 501.
colnames(data) %>%
tail(n = 173) #columnas de mutaciones
#genes asociados a cáncer de mama: BRCA1, BRCA2, PALB2, CHEK2, CDH1
# Asume que tu data frame de Z-Scores se llama 'datos_expresion'
genes_buscados <- c("brca1", "brca2", "palb2", "chek2", "cdh1")
# Usar grep para buscar esos nombres en las columnas
genes_encontrados_expresion <- colnames(datos_expresion) %>%
grep(paste(genes_buscados, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print("Genes encontrados en la tabla de Expresión (Z-Scores):")
print(genes_encontrados_expresion)
zscore <- datos_geneticos %>%
head(n= 520)
zscore
mutaciones <- colnames(data) %>%
tail(n = 173) #columnas de mutaciones
mutaciones
zscore <- colnames(datos_geneticos) %>%
head(n= 520)
zscore
mutaciones <- colnames(data) %>%
tail(n = 173) #columnas de mutaciones
mutaciones
datos_geneticos
colgeneticos <- colnames(datos_geneticos) %>%
head(n= 693)
colgeneticos
mutaciones <- colnames(data) %>%
tail(n = 203) #columnas de mutaciones
mutaciones #173 o 203
mutaciones <- colnames(datos_geneticos) %>%
tail(n = 203) #columnas de mutaciones
mutaciones #173 o 203
mutaciones <- colnames(datos_geneticos) %>%
tail(n = 173) #columnas de mutaciones
mutaciones #173 o 203
mutaciones <- colnames(datos_geneticos) %>%
tail(n = 174) #columnas de mutaciones
mutaciones #173 o 203
mutaciones <- colnames(datos_geneticos) %>%
tail(n = 173) #columnas de mutaciones
mutaciones #173 o 203
#convertimos espacios vacíos en NAs
datos_geneticos[datos_geneticos == ""] <- NA
#número de NA por columna
na_geneticos <- colSums(is.na(datos_geneticos))
na_geneticos[na_geneticos > 0]
#número de NA por columna
na_geneticos <- colSums(is.na(datos_geneticos))
na_geneticos[na_geneticos > 0]
na_geneticos
#quiero extraer las columnas de mutaciones
# Seleccionar columnas que terminan en "_mut"
mutaciones_cols <- grep("_mut$", colnames(datos_geneticos), value = TRUE)
# Crear un dataframe solo con mutaciones
datos_mutaciones <- datos_geneticos %>% select(all_of(mutaciones_cols))
View(datos_mutaciones)
mrna <- data %>%
select(32:520)
mrna
mrna(colnames)
mrna <- data %>%
select(32:520)
mrna(colnames)
colnames(mrna)
mrna <- data %>%
select(32:521)
colnames(mrna)
mrna <- data %>%
select(32:520)
colnames(mrna)
datos_mrna <- data %>%
select(32:520)
colnames(mrna)
# Crear un dataframe solo con mutaciones
datos_mutaciones <- datos_geneticos %>% select(all_of(mutaciones_cols))
datos_mrna <- data %>%
select(32:520)
#######################################
# 2.2 DATOS GENÉTICOS: ARNm y MUTACIONES
###################################
# Datos genéticos: ARNm + mutaciones
datos_geneticos <- data %>%
select(32:693) #sabemos que el resto son genéticos
#######################################
# 2.2 DATOS GENÉTICOS: ARNm y MUTACIONES
###################################
# Datos genéticos: ARNm + mutaciones
datos_geneticos <- data %>%
select(32:693) #sabemos que el resto son genéticos
#dependencias
library(readxl)
library(dplyr)
library(naniar)
library(ggplot2)
library(tidyr)
library(FSA)
#cargamos base de datos
data <- read.csv("C:/Users/usuario/Downloads/archive/METABRIC_RNA_Mutation.csv")
#######################################
# 2.2 DATOS GENÉTICOS: ARNm y MUTACIONES
###################################
# Datos genéticos: ARNm + mutaciones
datos_geneticos <- data %>%
select(32:693) #sabemos que el resto son genéticos
colgeneticos <- colnames(datos_geneticos) %>%
head(n= 693)
colgeneticos
mrna <- colnames(datos_geneticos) %>%
head(n= 520)
zscore
mrna
colnames(datos_geneticos) %>%
tail(n = 175) #la base de datos dice que hay 175 pero parece haber 173
#convertimos espacios vacíos en NAs
datos_geneticos[datos_geneticos == ""] <- NA
#número de NA por columna
na_geneticos <- colSums(is.na(datos_geneticos))
na_geneticos[na_geneticos > 0] # no hay NAs
#quiero extraer las columnas de mutaciones
# Seleccionar columnas que terminan en "_mut"
mutaciones_cols <- grep("_mut$", colnames(datos_geneticos), value = TRUE) #son 173
# Crear un dataframe solo con mutaciones
datos_mutaciones <- datos_geneticos %>% select(all_of(mutaciones_cols))
datos_mrna <- data %>%
select(32:520)
colnames(mrna) # selecciono los mrna (z scores)
colnames(datos_mrna) # selecciono los mrna (z scores)
# Usar grep para buscar esos nombres en las columnas
genes_encontrados_expresion <- colnames(datos_mrna) %>%
grep(paste(genes_buscados, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print("Genes encontrados en la tabla de Expresión (Z-Scores):")
print(genes_encontrados_expresion)
# Usar grep para buscar esos nombres en las columnas
genes_encontrados_expresion <- colnames(datos_mrna) %>%
grep(paste(datos_mrna, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print(genes_encontrados_expresion)
#genes asociados a cáncer de mama: BRCA1, BRCA2, PALB2, CHEK2, CDH1
# Asume que tu data frame de Z-Scores se llama 'datos_expresion'
genes_buscados <- c("brca1", "brca2", "palb2", "chek2", "cdh1")
# Usar grep para buscar esos nombres en las columnas
genes_encontrados_expresion <- colnames(datos_mrna) %>%
grep(paste(genes_buscados, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print("Genes encontrados en la tabla de Expresión (Z-Scores):")
print(genes_encontrados_expresion)
install.packages(pheatmap)
install.packages("pheatmap")
library(pheatmap)
#heatmap
pheatmap(datos_mrna[, genes_encontrados_expresion])
# y aver si están en mutaciones
genes_encontrados_expresion <- colnames(datos_mutaciones) %>%
grep(paste(genes_buscados, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print("Genes encontrados en la tabla de Expresión (Z-Scores):")
print(genes_encontrados_expresion)
print(genes_encontrados_expresion)
#genes asociados a cáncer de mama: BRCA1, BRCA2, PALB2, CHEK2, CDH1
# Asume que tu data frame de Z-Scores se llama 'datos_expresion'
genes_buscados <- c("brca1", "brca2", "palb2", "chek2", "cdh1")
# Usar grep para buscar esos nombres en las columnas
genes_encontrados_expresion <- colnames(datos_mrna) %>%
grep(paste(genes_buscados, collapse = "|"), ., value = TRUE, ignore.case = TRUE)
print("Genes encontrados en la tabla de Expresión (Z-Scores):")
print(genes_encontrados_expresion)
#relación entre z score brca2 y mutation_count
grafico_mutationz <- data %>%
select(brca2, mutation_count)
#relación entre z score brca2 y mutation_count
grafico_mutationz <- data %>%
select(brca2, mutation_count) %>%
filter(!is.na(brca2) & !is.na(mutation_count))
# creamos el Gráfico de Dispersión
dispersion_brca2 <- datos_grafico %>%
ggplot(aes(x = brca2, y = mutation_count)) +
# Puntos de dispersión (pacientes)
geom_point(alpha = 0.6, color = "darkblue") +
# Línea de regresión lineal (método lm) con su intervalo de confianza
# Esto visualiza la correlación
geom_smooth(method = "lm", color = "red", se = TRUE) +
labs(
title = "Correlación entre Expresión de BRCA2 y Carga Mutacional",
x = "Expresión de BRCA2 (Z-Score)",
y = "Conteo de Mutaciones (Inestabilidad Genómica)"
) +
theme_bw()
print(dispersion_brca2)
# creamos el Gráfico de Dispersión
dispersion_brca2 <- grafico_mutationz %>%
ggplot(aes(x = brca2, y = mutation_count)) +
# Puntos de dispersión (pacientes)
geom_point(alpha = 0.6, color = "darkblue") +
# Línea de regresión lineal (método lm) con su intervalo de confianza
# Esto visualiza la correlación
geom_smooth(method = "lm", color = "red", se = TRUE) +
labs(
title = "Correlación entre Expresión de BRCA2 y Carga Mutacional",
x = "Expresión de BRCA2 (Z-Score)",
y = "Conteo de Mutaciones (Inestabilidad Genómica)"
) +
theme_bw()
print(dispersion_brca2)
cor.test(grafico_mutationz$brca2m grafico_mutationz$mutation_count, method= "spearman")
cor.test(grafico_mutationz$brca2m, grafico_mutationz$mutation_count, method= "spearman")
cor.test(grafico_mutationz$brca2, grafico_mutationz$mutation_count, method= "spearman")
cor.test(grafico_mutationz$brca2, grafico_mutationz$mutation_count, method= "pearson")
filter(!is.na(pam50_._claudin.low_subtype) & !is.na(mutation_count)) %>%
ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
filter(!is.na(pam50_._claudin.low_subtype) & !is.na(mutation_count))
filter(!is.na(pam50_+_claudin.low_subtype) & !is.na(mutation_count))
# 2.1 DATOS CLÍNICOS ################################
#################################################
col_datosclinicos <- colnames(data) %>%
head(n = 31)
View(col_datosclinicos)
datos_clinicos <- data %>%
select(col_datosclinicos) #selecciono datos clinicos de toda la base de datos (data)
str(datos_clinicos)
dim(datos_clinicos)
View(datos_clinicos)
datos_combinados <- data %>%
select(`pam50_._claudin.low_subtype`, mutation_count)
datos_combinados <- data %>%
select(`pam50_._claudin.low_subtype`, mutation_count)
filter(!is.na(`pam50_._claudin.low_subtype`) & !is.na(mutation_count))
# grafico conteo de mutaciones frente subtipo
# Asumiendo que 'datos_combinados' está unido y limpio de NAs en las columnas
datos_combinados <- data %>%
select(`pam50_._claudin.low_subtype`, mutation_count) %>%
filter(!is.na(`pam50_._claudin.low_subtype`) & !is.na(mutation_count))
ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
datos_combinados %>% ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
#existen diferencias significativas?
#voy a usar kruskal wallis
kruskal.test(mutation_count ~ `pam50_._claudin.low_subtype`, data= datos_combinados)
datos_combinados %>% ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7, show.legend = FALSE) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
datos_combinados %>% ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6, show.legend = FALSE) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7, show.legend = FALSE) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
library(dunn.test)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$pam50_._claudin.low_subtype,
method= "bonferroni",
atlp= TRUE, # muestra p valor ajustado
table = TRUE # muestra resultados en formato tabla
)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$`pam50_._claudin.low_subtype`,
method= "bonferroni",
atlp= TRUE, # muestra p valor ajustado
table = TRUE # muestra resultados en formato tabla
)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$`pam50_._claudin.low_subtype`,
method= "bonferroni",
altp= TRUE, # muestra p valor ajustado
table = TRUE # muestra resultados en formato tabla
)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$`pam50_._claudin.low_subtype`,
method= "bonferroni",
altp= TRUE, # muestra p valor ajustado
table = TRUE,
filter(p-value < 0.05)# muestra resultados en formato tabla
)
#filtramos solo datos significativos
# 3. Crear un data frame a partir de los vectores de resultados
dunn_df <- data.frame(
Comparison = dunn_subtipo$comparisons,
Z_Value = dunn_subtipo$Z,
P_Adjusted = dunn_subtipo$P.adjust
)
colnames(dunn_subtipo)
print(dunn_subtipo)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$`pam50_._claudin.low_subtype`,
method= "bonferroni",
altp= TRUE, # muestra p valor ajustado
table = TRUE,# muestra resultados en formato tabla
)
dunn_subtipo
dunn_subtipo %>% select(
altP.adjusted, comparisons
)
dunn_subtipo %>% select(altP.adjusted, comparisons)
pycomp <- dunn_subtipo %>% select(altP.adjusted, comparisons)
#para ver entre qué grupos existe diferencia: post hoc, Dunns
dunn_subtipo <- dunn.test(
x= datos_combinados$mutation_count,
g= datos_combinados$`pam50_._claudin.low_subtype`,
method= "bonferroni",
altp= TRUE, # muestra p valor ajustado
table = TRUE,# muestra resultados en formato tabla
)
datos_combinados %>% ggplot(aes(x = pam50_._claudin.low_subtype, y = mutation_count, fill = pam50_._claudin.low_subtype)) +
geom_violin(alpha = 0.6, show.legend = FALSE) + # Violin plot muestra la densidad de los datos
geom_boxplot(width = 0.1, color = "black", alpha = 0.7, show.legend = FALSE) + # Añade la mediana/quartiles
labs(
title = "Carga Mutacional por Subtipo Molecular PAM50",
x = "Subtipo Molecular",
y = "Conteo de Mutaciones",
fill = "Subtipo"
) +
theme_bw() +
scale_fill_viridis_d()
#quiero graficar el tamaño del tumor y la supervivencia
coxph(Surv(overall_survival_months, overall_survival) ~ tumor_size, data = datos)
#instalar paquetes necesarios
#install.packages("dplyr")
#install.packages("naniar")
#install.packages("FSA")
install.packages("survival")
library(survival)
#quiero graficar el tamaño del tumor y la supervivencia
coxph(Surv(overall_survival_months, overall_survival) ~ tumor_size, data = datos_clinicos)
#instalar paquetes necesarios
#install.packages("dplyr")
#install.packages("naniar")
#install.packages("FSA")
#install.packages("survival")
install.packages("survminer")
library(survminer)
ggsurvplot(survfit(Surv(overall_survival_months, overall_survival) ~ tumor_stage,
data = datos_clinicos))
ggsurvplot(survfit(Surv(overall_survival_months, overall_survival) ~ tumor_stage,
data = datos_clinicos)) #parece que hay diferencias
ggplot(datos_clinicos, aes(x = tumor_size, y = overall_survival_months)) +
geom_point(alpha = 0.3) +
geom_smooth(method = "loess", color = "blue") +
labs(title = "Relación entre tamaño del tumor y supervivencia",
x = "Tamaño del tumor (mm)",
y = "Supervivencia global (meses)") +
theme_minimal()
#modelo de cox multivariante
modelo_cox <- coxph(Surv(overall_survival_months, overall_survival) ~ tumor_size_cat + tumor_stage + age_at_diagnosis, data = datos_clinicos)
#modelo de cox multivariante
modelo_cox <- coxph(Surv(overall_survival_months, overall_survival) ~ tumor_size + tumor_stage + age_at_diagnosis, data = datos_clinicos)
summary(modelo_cox)
ggforest(modelo_cox, data = datos_clinicos)
coxph(Surv(overall_survival_months, overall_survival) ~
tumor_size_cat + tumor_stage + age_at_diagnosis,
data = datos_clinicos)
coxph(Surv(overall_survival_months, overall_survival) ~
tumor_size + tumor_stage + age_at_diagnosis,
data = datos_clinicos)
ggcoxfunctional(Surv(overall_survival_months, overall_survival) ~ age_at_diagnosis,
data = datos_clinicos)
modelo_cox_spline <- coxph(
Surv(overall_survival_months, overall_survival) ~
tumor_size_cat + tumor_stage + ns(age_at_diagnosis, df = 3),
data = datos_clinicos
)
modelo_cox_spline <- coxph(
Surv(overall_survival_months, overall_survival) ~
tumor_size + tumor_stage + ns(age_at_diagnosis, df = 3),
data = datos_clinicos
)
#instalar paquetes necesarios
#install.packages("dplyr")
#install.packages("naniar")
#install.packages("FSA")
#install.packages("survival")
#install.packages("survminer")
install.packages("splines")
library(splines)
modelo_cox_spline <- coxph(
Surv(overall_survival_months, overall_survival) ~
tumor_size + tumor_stage + ns(age_at_diagnosis, df = 3),
data = datos_clinicos
)
summary(modelo_cox_spline)
ggcoxfunctional(Surv(overall_survival_months, overall_survival) ~ age_at_diagnosis,
data = datos_clinicos)
modelo_cox_spline <- coxph(
Surv(overall_survival_months, overall_survival) ~
tumor_size + tumor_stage + ns(age_at_diagnosis, df = 3),
data = datos_clinicos
)
summary(modelo_cox_spline)
install.packages("usethis")
library(usethis)
gitcreds::gitcreds_set()
